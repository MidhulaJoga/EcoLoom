<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Customize Item</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 p-6 min-h-screen">
  <!-- Header -->
  <div class="bg-white shadow-md p-4 mb-6">
    <div class="flex justify-between items-center max-w-2xl mx-auto">
      <div class="text-lg font-bold text-green-700">Ecoloom</div>
      <div class="flex space-x-4">
        <a href="profile.html" class="text-lg font-bold text-green-700">Profile</a>
        <a href="home.html" class="text-lg font-bold text-green-700">Home</a>
      </div>
    </div>
  </div>

  <h1 class="text-3xl font-bold text-green-700 mb-6 text-center">ðŸŽ¨ Customize Your Item</h1>

  <div class="bg-white rounded shadow p-6 space-y-6 max-w-2xl mx-auto">
    <div class="flex flex-col items-center space-y-6">
      <button id="edit-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded text-lg">
         Customize Your Own Design
      </button>

      <button id="contact-btn" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded text-lg">
         Contact Us
      </button>

      <button id="help-btn" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded text-lg">
         Help
      </button>

      <button id="confirm-order-btn" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded text-lg">
         Confirm Order
      </button>

      <p id="contact-response" class="mt-4 text-lg font-semibold text-center text-gray-800"></p>

      <!-- Decline Reason Display -->
      <div id="decline-reason" class="hidden bg-red-100 text-red-700 p-4 rounded text-center">
        <p><strong>Order Declined:</strong> <span id="decline-message"></span></p>
      </div>
    </div>
  </div>

  <!-- Confirm Order Modal -->
  <div id="confirm-order-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded shadow max-w-md w-full">
      <h2 class="text-xl font-bold text-gray-800 mb-4">Confirm Your Order</h2>
      <form id="order-form" class="space-y-4">
        <label for="customized-image" class="block text-gray-800">Upload your customized item:</label>
        <input type="file" id="customized-image" class="border rounded w-full p-2" required>

        <label for="item-description" class="block text-gray-800">Item Description:</label>
        <textarea id="item-description" class="border rounded w-full p-2" rows="3" placeholder="Describe your item" required></textarea>

        <label for="address" class="block text-gray-800">Your Shipping Address:</label>
        <textarea id="address" class="border rounded w-full p-2" rows="3" placeholder="Enter your address" required></textarea>

        <label for="price" class="block text-gray-800">Enter Amount to Pay (â‚¹):</label>
        <input type="number" id="price" class="border rounded w-full p-2" placeholder="Enter amount" required>

        <div class="flex justify-between items-center">
          <button type="submit" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded text-lg">Confirm</button>
          <button type="button" id="close-order-btn" class="bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded text-lg">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const editBtn = document.getElementById('edit-btn');
    const contactBtn = document.getElementById('contact-btn');
    const helpBtn = document.getElementById('help-btn');
    const confirmOrderBtn = document.getElementById('confirm-order-btn');
    const contactResponse = document.getElementById('contact-response');
    const confirmOrderModal = document.getElementById('confirm-order-modal');
    const closeOrderBtn = document.getElementById('close-order-btn');
    const orderForm = document.getElementById('order-form');
    const declineReasonDiv = document.getElementById('decline-reason');
    const declineMessage = document.getElementById('decline-message');

    editBtn.addEventListener('click', () => {
      window.open('https://www.canva.com', '_blank');
    });

    contactBtn.addEventListener('click', () => {
      const user = JSON.parse(localStorage.getItem("currentUser")) || {
        name: "Test User",
        email: "test@example.com"
      };
      localStorage.setItem("contactRequest", JSON.stringify(user));
      const contactWindow = window.open("contact-request.html", "_blank", "width=400,height=400");

      window.addEventListener("message", function handler(event) {
        if (event.data.contactResult === "accepted") {
          contactResponse.textContent = "âœ… Contact them through ecoloom@gmail.com";
        } else if (event.data.contactResult === "declined") {
          contactResponse.textContent = "âŒ Try again";
        }
        window.removeEventListener("message", handler);
      });
    });

    helpBtn.addEventListener('click', () => {
      alert("Go to Canva to design, then upload here to order!");
    });

    confirmOrderBtn.addEventListener('click', () => {
      confirmOrderModal.classList.remove('hidden');
    });

    closeOrderBtn.addEventListener('click', () => {
      confirmOrderModal.classList.add('hidden');
    });

    orderForm.addEventListener('submit', (e) => {
      e.preventDefault();

      const imageFile = document.getElementById('customized-image').files[0];
      const description = document.getElementById('item-description').value;
      const address = document.getElementById('address').value;
      const price = document.getElementById('price').value;

      const reader = new FileReader();
      reader.onload = function(event) {
        const imageData = event.target.result;
        const user = JSON.parse(localStorage.getItem("currentUser")) || {
          name: "Test User",
          email: "test@example.com"
        };

        const orderData = {
          name: user.name,
          email: user.email,
          image: imageData,
          description: description,
          address: address,
          price: price
        };

        localStorage.setItem("orderRequest", JSON.stringify(orderData));
        window.open("order-request.html", "_blank", "width=500,height=600");
        confirmOrderModal.classList.add('hidden');
      };
      if (imageFile) {
        reader.readAsDataURL(imageFile);
      } else {
        alert("Please upload your customized image.");
      }
    });

    window.addEventListener("message", (event) => {
  if (event.data.orderResult === "accepted") {
    contactResponse.textContent = "âœ… Order Confirmed!";
    contactResponse.classList.remove('text-gray-800');
    contactResponse.classList.add('text-green-700');
    declineReasonDiv.classList.add('hidden');
  } else if (event.data.orderResult === "declined") {
    declineReasonDiv.classList.remove('hidden');
    declineMessage.textContent = event.data.reason;
    contactResponse.textContent = "";
  }
});

  </script>
</body>
</html>
